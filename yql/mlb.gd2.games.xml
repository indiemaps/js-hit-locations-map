<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
	<meta>
		<author>Zachary Forest Johnson</author>
		<documentationURL>muggable</documentationURL>
		<sampleQuery>select * from mlb.gd2.games where year="2009" and month="07" and day="03" and runs_away>10.5</sampleQuery>
	</meta>
	<bindings>
		<select itemPath="result.game" produces="JSON">
			<urls>
				<url>http://gd2.mlb.com/components/game/mlb/</url>
			</urls>

			<inputs>
				<key id="month" type="xs:string" paramType="variable" required="true" />
				<key id="year" type="xs:string" paramType="variable" required="true" />
				<key id="day" type="xs:string" paramType="variable" required="true" />
			</inputs>

			<execute>
				<![CDATA[
				var baseURI = "http://gd2.mlb.com/components/game/mlb/";
        		var datePart = "year_" + year + "/month_" + month + "/day_" + day;
        		var scoreboardPart = "/scoreboard.xml";
        		var scoreboardURLForDate = baseURI + datePart + scoreboardPart;
        		
        		var xml = y.rest( scoreboardURLForDate ).get().response;     		
        		
        		var gamesObject = { 'game' : new Array() };
        		
        		for each ( var game in xml.go_game ) {        			
        			var gid = game.game.@[ 'id' ];

        			var gameURL = baseURI + datePart + '/gid_' + gid + '/game.xml';
        			var boxURL = baseURI + datePart + '/gid_' + gid + '/boxscore.xml';
        			
        			var boxscoreXML = y.rest( boxURL ).get().response;
        			var gameXML = y.rest( gameURL ).get().response;
        			
        			// var home = boxscoreXML.@[ 'home_team_code' ].toString();
        			// var away = boxscoreXML.@[ 'away_team_code' ].toString();
        			
        			var ar = boxscoreXML.game_info.toString().match(/<br\/><b>Weather<\/b>: (\d+) degrees,.*<br\/><b>Wind<\/b>: (\d+) mph, ([\w\s]+).<br\/>/);
        			
        			var gameObject = {
        				'game_id' 		: 'honkers',
  						'date' 			: '',
  						'home' 			: boxscoreXML.@home_team_code.toString(),
  						'away' 			: boxscoreXML.@away_team_code.toString(),
  						'game' 			: parseInt( boxscoreXML.@game_id.toString().substr( -1 ) ),
  						'umpire' 		: '',
  						'wind' 			: parseFloat( RegExp.$2 ),
  						'wind_dir' 		: RegExp.$3,
  						'temp' 			: parseFloat( RegExp.$1 ),
  						'type' 			: gameXML.@type.toString(),
  						'runs_home' 	: parseFloat( boxscoreXML.linescore.@home_team_runs.toString() ),
  						'runs_away' 	: parseFloat( boxscoreXML.linescore.@away_team_runs.toString() ),
  						'local_time' 	: gameXML.@local_game_time.toString()
        			};
        			
        			// get the weather info from the boxscore
        			
        			// get the 
        			
        			gamesObject.game.push( gameObject );
        		}
        		
        		response.object = gamesObject;
        		
      			]]>
			</execute>
		</select>
	</bindings>
</table>